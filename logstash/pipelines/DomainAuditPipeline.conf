input { pipeline { address => "DomainAudit" } }

filter {
  # Use the given timestamp from the event for the logstash timestamp and send to ElasticSearch
  date {
      match => [ "time", "UNIX_MS" ]
  }
  mutate {
    add_field => { "[processInfo][gatewayName]" => "%{[gatewayName]}" }
    add_field => { "[processInfo][gatewayRegion]" => "%{[gatewayRegion]}" }
  }
}

output {
  elasticsearch {
    hosts => "${ELASTICSEARCH_HOSTS}"
    ssl => true
    cacert => "${ELASTICSEARCH_CERT}"
    user => "${LOGSTASH_USERNAME}"
    password => "${LOGSTASH_PASSWORD}"
    ilm_enabled => true
    ilm_rollover_alias => "apigw-domainaudit"
    ilm_pattern => "000001"
    template => "${HOME}/index_templates/domainaudit_index_template.json"
    template_name => "apigw-domainaudit"
    template_overwrite => true
    id => "DomainAudit"
  }
# Enable if you would like to see outgoing event messages
#  stdout {
#    codec => rubydebug
#  }
}